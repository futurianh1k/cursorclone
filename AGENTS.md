# AGENTS (Codex 작업 규칙) — On-Prem PoC

## 보안/온프레미스 원칙
1. 외부 네트워크(인터넷) 호출 금지. (허용된 내부 주소만)
2. 소스코드/프롬프트/응답 원문을 로그에 저장하지 않는다.
   - 저장이 필요하면 hash + 메타데이터만 저장.
3. Workspace 경로 밖 접근 금지. (../, 심볼릭 링크 탈출 방지)
4. 코드 변경은 반드시 **Patch(Diff)** 를 생성하고,
   `/patch/validate` → `/patch/apply` 경로로 적용한다.


## 개발 원칙
- Web(Next.js)은 LLM을 직접 호출하지 않는다. 반드시 API를 통해 호출.
- API는 LLM을 직접 호출하지 않는다. 반드시 Context Builder 경유(추후).
- 모든 새 기능은 최소 1개 테스트(단위 또는 계약 테스트)를 포함.
- 외부 기능·자료 사용 및 알고리즘 구현 시 출처 명시
  외부 API, 라이브러리, 논문, 블로그, 문서 등을 참고하거나 사용한 경우, 참조한 자료의 출처(URL 또는 서지) 를 반드시 명시합니다.
- 알고리즘(특히 비표준/직접 구현한 경우) 설명에 사용한 참고자료도 함께 표기합니다.
- 수정 내용 표시 (Changes shown in chat)
  코드나 파일을 추가·수정·삭제할 때는 작업 전에 간단한 설명(무엇을, 왜 하는지)을 먼저 채팅에 알리고, 변경 패치를 적용하면 적용된 변경 내용을 채팅에 그대로 표시 합니다(파일 경로와 전체/변경된 내용 포함).
- apply_patch로 파일을 생성/수정할 때 생성된 패치와 파일 내용을 채팅에서 확인할 수 있도록 합니다.
- 구현한 기능에 대한 테스트 코드 작성
  새로운 기능이나 변경이 있을 경우 해당 기능을 검증하는 테스트 코드를 함께 작성합니다. (이 프로젝트에서는 vitest가 사용됩니다.)
- 중대한 변경 시 브랜치 생성
  신기능 구현, DB 구조 변경, UI 레이아웃 대규모 변경 등 중대한 변경을 할 때는 반드시 새로운 Git 브랜치를 생성합니다.
  브랜치 네이밍 규칙 예: feature/{짧은-설명}, fix/{짧은-설명}, chore/{짧은-설명}
- 중대한 변경에 대한 기록 (history)
  중대한 변경을 적용할 때는 history/ 폴더에 변경 내역 문서를 추가합니다. 문서에는 아래 항목을 반드시 포함합니다:
    요청자(사용자) 요구사항 요약
    Assistant(제가) 응답 내용(무엇을 할지)
    실제로 수행한 변경 내용(파일/쿼리/설계 요약)
    테스트 및 검증 방법
    향후 작업 제안 또는 주의사항
    

## 출력 규칙 (Codex)
- 변경 사항은 작게 쪼개고, 커밋 메시지 제안 포함.
- 불확실한 부분은 TODO 주석으로 남기되, PoC 흐름은 막지 말 것.


## 문서화
- docs 폴더를 만들고, 내와 대화한 프롬프트 내용과 네가 작업한 내용을 기록한다.
  대화 마다 번호를 붙인다. '예: 0001-...'

## 형상관리
- 커뮤니케이션 및 PR/커밋 메시지
변경 시 커밋 메시지와 PR 본문에 위의 출처, 테스트, 브랜치 정보를 포함합니다.